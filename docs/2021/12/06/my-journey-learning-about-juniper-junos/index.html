<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author"
    content="">
<meta name="description"
    content="Introduction Hello and thank you for checking out another blog post. I’ve been under the weather for a bit but I am back on the keys. This post will be all about some neat things I discovered while learning a bit about the Juniper Junos NOS (network operating system). Previously I had never used Juniper, it was a vendor that always eluded me. My previous employers did not utilize this NOS and I never got around to adding it in the lab." />
<meta name="keywords"
    content=", Junos, Network Automation, Python" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://juliopdx.com/2021/12/06/my-journey-learning-about-juniper-junos/" />


<title>
    
    My Journey Learning About Juniper Junos :: Welcome to the World of Tomorrow  — Welcome to my blog!
    
</title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.57323f540d7cbe7c215b2d5060bc45c58f58b905f86869d7183bb27c42937f00.css">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="My Journey Learning About Juniper Junos">
<meta itemprop="description" content="Introduction Hello and thank you for checking out another blog post. I’ve been under the weather for a bit but I am back on the keys. This post will be all about some neat things I discovered while learning a bit about the Juniper Junos NOS (network operating system). Previously I had never used Juniper, it was a vendor that always eluded me. My previous employers did not utilize this NOS and I never got around to adding it in the lab."><meta itemprop="datePublished" content="2021-12-06T13:57:09-08:00" />
<meta itemprop="dateModified" content="2021-12-06T13:57:09-08:00" />
<meta itemprop="wordCount" content="2582"><meta itemprop="image" content="https://juliopdx.com/blog/images/v2osk.jpg">
<meta itemprop="keywords" content="Junos,Network Automation,Python," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://juliopdx.com/blog/images/v2osk.jpg"/>

<meta name="twitter:title" content="My Journey Learning About Juniper Junos"/>
<meta name="twitter:description" content="Introduction Hello and thank you for checking out another blog post. I’ve been under the weather for a bit but I am back on the keys. This post will be all about some neat things I discovered while learning a bit about the Juniper Junos NOS (network operating system). Previously I had never used Juniper, it was a vendor that always eluded me. My previous employers did not utilize this NOS and I never got around to adding it in the lab."/>




<meta property="og:title" content="My Journey Learning About Juniper Junos" />
<meta property="og:description" content="Introduction Hello and thank you for checking out another blog post. I’ve been under the weather for a bit but I am back on the keys. This post will be all about some neat things I discovered while learning a bit about the Juniper Junos NOS (network operating system). Previously I had never used Juniper, it was a vendor that always eluded me. My previous employers did not utilize this NOS and I never got around to adding it in the lab." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://juliopdx.com/2021/12/06/my-journey-learning-about-juniper-junos/" /><meta property="og:image" content="https://juliopdx.com/blog/images/v2osk.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-06T13:57:09-08:00" />
<meta property="article:modified_time" content="2021-12-06T13:57:09-08:00" /><meta property="og:site_name" content="Welcome to the World of Tomorrow" />







<meta property="article:published_time" content="2021-12-06 13:57:09 -0800 PST" />












    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">#</span>
            <span class="logo__text">JulioPDX</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#41FF00;
                   animation-duration:2s;">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/posts">Blog</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        13 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://juliopdx.com/2021/12/06/my-journey-learning-about-juniper-junos/">My Journey Learning About Juniper Junos</a>
      </h1>

      

      
        <hr />
        <aside id="toc">
          <div class="toc-title">Table of Contents</div>
          <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#what-is-junos">What is Junos?</a></li>
    <li><a href="#reading-the-junos-cli">Reading the Junos CLI</a></li>
    <li><a href="#cli-modes">CLI Modes</a></li>
    <li><a href="#configuring-junos">Configuring Junos</a></li>
    <li><a href="#replace-compare-and-commit">Replace, Compare, and Commit</a></li>
    <li><a href="#rollback-and-commit-confirmed">Rollback and Commit Confirmed</a></li>
    <li><a href="#viewing-configuration-as-set-commands">Viewing Configuration as Set Commands</a></li>
    <li><a href="#bonus-automating-the-configuration">Bonus: Automating the Configuration</a>
      <ul>
        <li><a href="#junos-configuration-hierarchy-and-jinja2">Junos Configuration Hierarchy and jinja2</a></li>
        <li><a href="#defining-host-data">Defining Host Data</a></li>
        <li><a href="#nornir-and-napalm">Nornir and NAPALM</a></li>
      </ul>
    </li>
    <li><a href="#outro-and-links">Outro and Links</a></li>
  </ul>
</nav>
        </aside>
        <hr />

      

      <div class="post-content">
        <h2 id="introduction">Introduction</h2>
<p>Hello and thank you for checking out another blog post. I’ve been under the weather for a bit but I am back on the keys. This post will be all about some neat things I discovered while learning a bit about the Juniper Junos NOS (network operating system). Previously I had never used Juniper, it was a vendor that always eluded me. My previous employers did not utilize this NOS and I never got around to adding it in the lab. Sit back and enjoy, I’ll include a neat automation example at the end.</p>
<h2 id="what-is-junos">What is Junos?</h2>
<p>Junos is the main operating system used in Juniper network devices. This could be the MX (routing), QFX (switching), and SRX (firewall). Since the same NOS is used across the product line, moving between them all in a configuration feels like being in the same device. This has a lot of benefits like eliminating that mode in your head of “which CLI am I in or which version of OS am I running?”. For the most part, it doesn’t matter, one configuration setting can transfer across all devices. At this point I’m probably overselling it, I’m sure there are some differences but you get the point.</p>
<h2 id="reading-the-junos-cli">Reading the Junos CLI</h2>
<p>When I first saw Junos CLI output… I’ll be honest, the first thought in my head was “WTF is that?”. Is it JSON? Is it a weird version of JSON? Most of my past experience was on the Cisco CLI and going from Cisco to this was a bit of a surprise. Below is a snippet from a Junos configuration (modified for brevity).</p>
<p><code>Junos Config Snippet</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">juliopdx@R1&gt; show configuration
## Last commit: 2021-12-06 11:19:02 PST by juliopdx
version 18.2R1.9;
system {
    login {
        message &#34;Welcome to the world of tomorrow!&#34;;
    }
    root-authentication {
        encrypted-password &#34;$6$xUmeLj6B$NBFrTm.&#34;; ## SECRET-DATA
    }
    host-name R1;
    time-zone America/Los_Angeles;
    services {
        ssh;
    }
}
interfaces {
    ge-0/0/0 {
        unit 0 {
            family inet {
                address 10.0.12.1/24;
            }
        }
    }
}
routing-options {
    static {
        route 0.0.0.0/0 {
            next-hop 192.168.10.1;
            no-readvertise;
        }
    }
    router-id 1.1.1.1;
}
protocols {
    ospf {
        reference-bandwidth 1g;
        area 0.0.0.0 {
            interface ge-0/0/0.0;
        }
    }
}
</code></pre></div><p>Looks a bit odd right? In reality, everything is in a nice orderly place. For example, any <strong>system</strong> configurations are neatly nested under that block. Any interface based settings would be under the <strong>interfaces</strong> block. Anything for OSPF is nested under <strong>protocols ospf</strong>.</p>
<h2 id="cli-modes">CLI Modes</h2>
<p>I think I’m getting a bit ahead of myself. Lets talk about the CLI modes. Junos mainly uses two CLI modes; operational and configuration. The mode you see displayed above is operational mode. Think of this as the mode you would use to view items or perform some… wait for it… operational tasks (monitor, troubleshoot, connectivity… ping). The second mode, configuration, is used to perform any and all configuration tasks on a Junos device.</p>
<p><code>Configuration Mode</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">juliopdx@R1&gt; configure
Entering configuration mode

[edit]
juliopdx@R1# &#34;Hi this is configuration mode&#34;
</code></pre></div><p>Earlier I ran <strong>show configuration</strong> to view the configuration in operational mode. These commands can be executed in configuration mode as well by prepending <strong>run</strong> to the command. Please note, <strong>show</strong> works a bit differently when in configuration mode. Typing <strong>show</strong> will simply display the current configuration tree we are in (hold that thought for just a moment).</p>
<p><code>Using ping with run</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">juliopdx@R1# run ping 10.0.23.3
PING 10.0.23.3 (10.0.23.3): 56 data bytes
64 bytes from 10.0.23.3: icmp_seq=0 ttl=64 time=331.137 ms
64 bytes from 10.0.23.3: icmp_seq=1 ttl=64 time=28.864 ms
64 bytes from 10.0.23.3: icmp_seq=2 ttl=64 time=697.261 ms
64 bytes from 10.0.23.3: icmp_seq=3 ttl=64 time=1142.495 ms
64 bytes from 10.0.23.3: icmp_seq=4 ttl=64 time=148.471 ms
^C
--- 10.0.23.3 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 28.864/469.646/1142.495/405.256 ms

[edit]
juliopdx@R1#
</code></pre></div><h2 id="configuring-junos">Configuring Junos</h2>
<p>At some point now we need to actually configure something. Let me just show you a small snippet of an interface configuration and we can walk through how the configuration goes.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">interfaces {
    ge-0/0/0 {
        unit 0 {
            family inet {
                address 10.0.12.1/24;
            }
        }
    }
</code></pre></div><p>When you want to configure or remove something in Junos, the commands will start with either <strong>set</strong> or <strong>delete</strong>. If we wanted to configure interface ge-0/0/0 with IP address 10.0.12.1/24, the command below would do just that.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">set interfaces ge-0/0/0 unit 0 family inet address 10.0.12.1/24
</code></pre></div><p>If you compare the configuration output to the command, its so similar, its basically the command in a tree format. You probably saw this and thought “What the heck is unit 0 and inet?”. Well <strong>unit 0</strong> will be used to create a sub-interface on the interface. Think of this as the default sub-interface that is created or all interfaces. Kind of how there is a secret default VRF in Cisco land but its not really displayed. The <strong>inet</strong> is essentially the IPv4 address family. Can you guess what <strong>inet6</strong> is?</p>
<p>That command got a bit long and there is an option to shorten our commands. Lets say for example we were about to drop a long configuration stanza on interface ge-0/0/0 and we wanted to shorten the amount of typing. We can actually tell Junos what section of the configuration we would like to edit. Example below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">juliopdx@R1# edit interfaces ge-0/0/0 unit 0 family inet

[edit interfaces ge-0/0/0 unit 0 family inet]
juliopdx@R1#
</code></pre></div><p>At this point we are in configuration mode and in the ge-0/0/0 interface hierarchy. Remember when I said hold that though on the <strong>show</strong> command? If we type <strong>show</strong> now, it will only display what section we are currently on. Another example below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">juliopdx@R1# show
address 10.0.12.1/24;

[edit interfaces ge-0/0/0 unit 0 family inet]
juliopdx@R1
</code></pre></div><p>Now if we wanted to configure that address, the command would be much shorter.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">juliopdx@R1# set address 10.0.12.1/24

[edit interfaces ge-0/0/0 unit 0 family inet]
juliopdx@R1#
</code></pre></div><h2 id="replace-compare-and-commit">Replace, Compare, and Commit</h2>
<p>I really like how Junos does this. If we were to make a change in Junos, it doesn’t immediately activate the change. It stores this in something called a candidate configuration. Lets test this. Currently interface ge-0/0/0 has an IP of 10.0.12.1, the remote side has an address of 10.0.12.2. Lets change the config and see if we can ping the remote side.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">[edit interfaces ge-0/0/0 unit 0 family inet]
juliopdx@R1# top

[edit]
juliopdx@R1# replace pattern 10.0.12.1/24 with 10.0.50.1/24

[edit]
juliopdx@R1#
</code></pre></div><p>I’ll walk through what is going on here. We entered <strong>top</strong> to return us to the highest level of the config hierarchy. We then execute another way of implementing a change, by using <strong>replace</strong>! This allows us to change a text patter with another, without stepping through the entire configuration. Lets check out the current state of our changes.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">juliopdx@R1# show | compare
[edit interfaces ge-0/0/0 unit 0 family inet]
+       address 10.0.50.1/24;
-       address 10.0.12.1/24;

[edit]
juliopdx@R1# run ping 10.0.12.2
PING 10.0.12.2 (10.0.12.2): 56 data bytes
64 bytes from 10.0.12.2: icmp_seq=0 ttl=64 time=269.266 ms
64 bytes from 10.0.12.2: icmp_seq=1 ttl=64 time=640.029 ms
64 bytes from 10.0.12.2: icmp_seq=2 ttl=64 time=116.563 ms
64 bytes from 10.0.12.2: icmp_seq=3 ttl=64 time=3.603 ms
^C
--- 10.0.12.2 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max/stddev = 3.603/257.365/640.029/240.205 ms

[edit]
juliopdx@R1#
</code></pre></div><p>At this point we can see that 10.0.12.1 has been replaced with 10.0.50.1 under the ge-0/0/0 interface. But we can still ping the remote side? This is because the change is only on the candidate configuration and not the running configuration. I’ll commit these changes and we should lose access to the remote side.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">juliopdx@R1# commit comment &#34;This is a bad config&#34;
commit complete

[edit]
juliopdx@R1# run ping 10.0.12.2
PING 10.0.12.2 (10.0.12.2): 56 data bytes
36 bytes from 4.68.38.157: Destination Net Unreachable
Vr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst
 4  5  00 0054 45fd   0 0000  3c  01 5773 192.168.10.143  10.0.12.2

36 bytes from 4.68.38.157: Destination Net Unreachable
Vr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst
 4  5  00 0054 4637   0 0000  3c  01 5739 192.168.10.143  10.0.12.2

36 bytes from 4.68.38.157: Destination Net Unreachable
Vr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst
 4  5  00 0054 464e   0 0000  3c  01 5722 192.168.10.143  10.0.12.2

^C
--- 10.0.12.2 ping statistics ---
5 packets transmitted, 0 packets received, 100% packet loss

[edit]
juliopdx@R1#
</code></pre></div><h2 id="rollback-and-commit-confirmed">Rollback and Commit Confirmed</h2>
<p>Clearly our change was not successful. Imagine this but at a grander scale than just my simple address change. Junos has a very simple option to go back to a previously working configuration. You may have noticed that we added a comment to our bad configuration change. Lets check out our previous commits.</p>
<p><code>Previous Commits</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">[edit]
juliopdx@R1# run show system commit
0   2021-12-06 14:32:57 PST by juliopdx via cli
    This is a bad config
1   2021-12-06 13:41:27 PST by juliopdx via netconf
</code></pre></div><p>I’m staying in configuration mode so some of these commands are prepended with <strong>run</strong>. It looks like commit 0, the latest commit is our bad commit. Commit 1 is our last known good state. Lets roll this back and see if that gets us operational.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">juliopdx@R1# rollback 1
load complete

[edit]
juliopdx@R1# show interfaces ge-0/0/0
unit 0 {
    family inet {
        address 10.0.12.1/24;
    }
}

[edit]
juliopdx@R1# commit
commit complete

[edit]
juliopdx@R1# run ping 10.0.12.2
PING 10.0.12.2 (10.0.12.2): 56 data bytes
64 bytes from 10.0.12.2: icmp_seq=0 ttl=63 time=338.004 ms
64 bytes from 10.0.12.2: icmp_seq=1 ttl=63 time=8.134 ms
64 bytes from 10.0.12.2: icmp_seq=2 ttl=63 time=6.880 ms
64 bytes from 10.0.12.2: icmp_seq=3 ttl=63 time=13.623 ms
^C
--- 10.0.12.2 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max/stddev = 6.880/91.660/338.004/142.249 ms

[edit]
juliopdx@R1#
</code></pre></div><p>Well that was easy! Another option for safety is commit confirmed. Basically, if you run commit confirmed, you will need to run commit again to make sure you want to implement the change. This is great in case you cut yourself off from the remote device. Example below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">juliopdx@R1# replace pattern 10.0.12.1/24 with 10.0.50.1/24

[edit]
juliopdx@R1# commit confirmed 1
commit confirmed will be automatically rolled back in 1 minutes unless confirmed
commit complete

# commit confirmed will be rolled back in 1 minute
[edit]
juliopdx@R1#
Broadcast Message from root@R1
        (no tty) at 14:44 PST...

Commit was not confirmed; automatic rollback complete.


[edit]
juliopdx@R1#
</code></pre></div><p>Pretty neat right? Since we did not type <strong>commit</strong> again, the change was automatically discarded.</p>
<h2 id="viewing-configuration-as-set-commands">Viewing Configuration as Set Commands</h2>
<p>There is another really neat way of viewing what has been configured on the device, <strong>display set</strong>. Imagine every <strong>set</strong> command that has been executed on the device being stored in a nice format that can be reused again. Please see snippet below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">[edit]
juliopdx@R1# run show configuration | display set
set interfaces ge-0/0/0 unit 0 family inet address 10.0.12.1/24
set interfaces ge-0/0/1 unit 0 family inet address 10.0.13.1/24
set interfaces ge-0/0/2 unit 0 family inet address 10.0.0.1/24
set interfaces fxp0 unit 0 family inet address 192.168.10.143/24
set interfaces lo0 unit 0 family inet address 1.1.1.1/32
set snmp description somedevice
set snmp location &#34;123 fake street&#34;
set snmp contact &#34;juliopdx@example.com&#34;
set snmp community juliopdx authorization read-only
set snmp trap-group test categories chassis
set snmp trap-group test categories link
set snmp trap-group test categories routing
set snmp trap-group test categories startup
set snmp trap-group test categories services
set snmp trap-group test targets 192.168.10.198
set routing-options static route 0.0.0.0/0 next-hop 192.168.10.1
set routing-options static route 0.0.0.0/0 no-readvertise
set routing-options router-id 1.1.1.1
set protocols ospf reference-bandwidth 1g
set protocols ospf area 0.0.0.0 interface ge-0/0/2.0 passive
set protocols ospf area 0.0.0.0 interface lo0.0 passive
set protocols ospf area 0.0.0.0 interface ge-0/0/0.0
set protocols ospf area 0.0.0.0 interface ge-0/0/1.0

[edit]
juliopdx@R1#
</code></pre></div><h2 id="bonus-automating-the-configuration">Bonus: Automating the Configuration</h2>
<p>I couldn’t help myself, I wanted to take a shot at automating some of the configuration during my Junos learning. I’ll keep this short and sweet but I stayed with the common tools of Nornir, NAPALM, and some neat Jinja2 templates. I have covered everything in the repository (linked below) before besides the Jinja2 templates. I’ll go over those and the script to close this one out.</p>
<h3 id="junos-configuration-hierarchy-and-jinja2">Junos Configuration Hierarchy and jinja2</h3>
<p>The Junos text output I showed you initially in this post really lends itself to being automated. Even from a text standpoint. Everything has really natural breaks in separation. I mentioned this before but if you wanted to modify interfaces, this would all be done under the interfaces level. I took that same approach and broke the Jinja templates out. We have a main <strong>base.j2</strong> template that will then call on the rest. This will then build the entire running configuration of a device.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">(</span>venv<span style="color:#f92672">)</span> juliopdx@juliopdx-pop:~/git/junos-auto$ tree templates/
templates/
├── base.j2
├── interfaces.j2
├── protocols.j2
├── routing-options.j2
├── snmp.j2
└── system.j2
</code></pre></div><p><code>base.j2</code></p>
<pre tabindex="0"><code class="language-jinja2" data-lang="jinja2">version 18.2R1.9;
{% include 'system.j2' %}

{% include 'interfaces.j2' %}

{% include 'snmp.j2' %}

{% include 'routing-options.j2' %}

{% include 'protocols.j2' %}
</code></pre><p><code>interfaces.j2</code></p>
<pre tabindex="0"><code class="language-jinja2" data-lang="jinja2">interfaces {
{% for interface in host.info.interfaces %}
    {{ interface.name }} {
        unit {{ interface.unit }} {
            family {{ interface.family }} {
                address {{ interface.address }};
            }
        }
    }
{% endfor %}
}
</code></pre><h3 id="defining-host-data">Defining Host Data</h3>
<p>I kept it simple and used YAML files to store data about each node. Please note this is a very simple example. There are definitely more ways to improve this and remove some of the duplicate information.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">(</span>venv<span style="color:#f92672">)</span> juliopdx@juliopdx-pop:~/git/junos-auto$ tree host_vars/
host_vars/
├── R1.yaml
├── R2.yaml
└── R3.yaml
</code></pre></div><p><code>R1.yaml</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
<span style="color:#f92672">interfaces</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ge-0/0/0</span>
    <span style="color:#f92672">unit</span>: <span style="color:#ae81ff">0</span>
    <span style="color:#f92672">family</span>: <span style="color:#ae81ff">inet</span>
    <span style="color:#f92672">address</span>: <span style="color:#ae81ff">10.0.12.1</span><span style="color:#ae81ff">/24</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ge-0/0/1</span>
    <span style="color:#f92672">unit</span>: <span style="color:#ae81ff">0</span>
    <span style="color:#f92672">family</span>: <span style="color:#ae81ff">inet</span>
    <span style="color:#f92672">address</span>: <span style="color:#ae81ff">10.0.13.1</span><span style="color:#ae81ff">/24</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ge-0/0/2</span>
    <span style="color:#f92672">unit</span>: <span style="color:#ae81ff">0</span>
    <span style="color:#f92672">family</span>: <span style="color:#ae81ff">inet</span>
    <span style="color:#f92672">address</span>: <span style="color:#ae81ff">10.0.0.1</span><span style="color:#ae81ff">/24</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">fxp0</span>
    <span style="color:#f92672">unit</span>: <span style="color:#ae81ff">0</span>
    <span style="color:#f92672">family</span>: <span style="color:#ae81ff">inet</span>
    <span style="color:#f92672">address</span>: <span style="color:#ae81ff">192.168.10.143</span><span style="color:#ae81ff">/24</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">lo0</span>
    <span style="color:#f92672">unit</span>: <span style="color:#ae81ff">0</span>
    <span style="color:#f92672">family</span>: <span style="color:#ae81ff">inet</span>
    <span style="color:#f92672">address</span>: <span style="color:#ae81ff">1.1.1.1</span><span style="color:#ae81ff">/32</span>

<span style="color:#f92672">routing_options</span>:
  <span style="color:#f92672">statics</span>:
    - <span style="color:#f92672">route</span>: <span style="color:#ae81ff">0.0.0.0</span><span style="color:#ae81ff">/0</span>
      <span style="color:#f92672">next_hop</span>: <span style="color:#ae81ff">192.168.10.1</span>
      <span style="color:#f92672">no_readvertise</span>: <span style="color:#66d9ef">True</span>
  <span style="color:#f92672">router_id</span>: <span style="color:#ae81ff">1.1.1.1</span>

<span style="color:#f92672">protocols</span>:
  <span style="color:#f92672">ospf</span>:
    <span style="color:#f92672">ref_band</span>: <span style="color:#ae81ff">1g</span>
    <span style="color:#f92672">areas</span>:
      <span style="color:#f92672">0.0.0.0</span>:
        <span style="color:#f92672">interfaces</span>:
          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ge-0/0/2.0</span>
            <span style="color:#f92672">passive</span>: <span style="color:#66d9ef">True</span>
          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">lo0</span>
            <span style="color:#f92672">passive</span>: <span style="color:#66d9ef">True</span>
          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ge-0/0/0.0</span>
          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ge-0/0/1.0</span>
</code></pre></div><h3 id="nornir-and-napalm">Nornir and NAPALM</h3>
<p>The script below was a mix of work I’ve done in the past and a great video by IPvZero (linked below). In the video John, demonstrates the use of the <strong>load_yaml</strong> and <strong>template_file</strong> methods in Nornir. The former will load YAML data that will then be assigned to the current host. This data can then be used by the <strong>template_file</strong> method to create configurations files for each host.</p>
<p><code>junos_norn.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#34;&#34;&#34;Script used to interfact with some Junos gear&#34;&#34;&#34;</span>
<span style="color:#f92672">from</span> nornir <span style="color:#f92672">import</span> InitNornir
<span style="color:#f92672">from</span> nornir_napalm.plugins.tasks <span style="color:#f92672">import</span> napalm_configure
<span style="color:#f92672">from</span> nornir_utils.plugins.functions <span style="color:#f92672">import</span> print_result
<span style="color:#f92672">from</span> nornir_utils.plugins.tasks.data <span style="color:#f92672">import</span> load_yaml
<span style="color:#f92672">from</span> nornir_jinja2.plugins.tasks <span style="color:#f92672">import</span> template_file


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load_vars</span>(task):
    <span style="color:#e6db74">&#34;&#34;&#34;Loads data to be added to each host from vars files&#34;&#34;&#34;</span>
    my_vars <span style="color:#f92672">=</span> task<span style="color:#f92672">.</span>run(task<span style="color:#f92672">=</span>load_yaml, file<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;./host_vars/</span><span style="color:#e6db74">{</span>task<span style="color:#f92672">.</span>host<span style="color:#e6db74">}</span><span style="color:#e6db74">.yaml&#34;</span>)
    task<span style="color:#f92672">.</span>host[<span style="color:#e6db74">&#34;info&#34;</span>] <span style="color:#f92672">=</span> my_vars<span style="color:#f92672">.</span>result
    template_configurations(task)


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">template_configurations</span>(task):
    <span style="color:#e6db74">&#34;&#34;&#34;Builds network templates&#34;&#34;&#34;</span>
    temp <span style="color:#f92672">=</span> task<span style="color:#f92672">.</span>run(
        name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Building device configuration&#34;</span>,
        task<span style="color:#f92672">=</span>template_file,
        path<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;templates&#34;</span>,
        template<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;base.j2&#34;</span>,
    )
    config <span style="color:#f92672">=</span> temp<span style="color:#f92672">.</span>result
    deploy_configurations(task, config)


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">deploy_configurations</span>(task, config):
    <span style="color:#e6db74">&#34;&#34;&#34;Loads device configurations&#34;&#34;&#34;</span>
    task<span style="color:#f92672">.</span>run(
        name<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Configuring </span><span style="color:#e6db74">{</span>task<span style="color:#f92672">.</span>host<span style="color:#e6db74">}</span><span style="color:#e6db74">!&#34;</span>,
        task<span style="color:#f92672">=</span>napalm_configure,
        configuration<span style="color:#f92672">=</span>config,
        replace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
    )


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
    <span style="color:#e6db74">&#34;&#34;&#34;Used to run all the things&#34;&#34;&#34;</span>
    norn <span style="color:#f92672">=</span> InitNornir(config_file<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;configs/config.yaml&#34;</span>, core<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;raise_on_error&#34;</span>: <span style="color:#66d9ef">True</span>})
    result <span style="color:#f92672">=</span> norn<span style="color:#f92672">.</span>run(task<span style="color:#f92672">=</span>load_vars)
    print_result(result)


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    main()
</code></pre></div><h2 id="outro-and-links">Outro and Links</h2>
<p>Thank you all for reading this far. I hope you learned a bit about Junos and some automation. What I showed in this post barely scratches the surface on what Junos can do, definitely more to learn! This wasn’t created in a bubble and I will link some awesome resources I had when learning about Junos and automation. Please check it out if you get a chance. I will definitely be using Junos more in my day to day labbing and learning.</p>
<ul>
<li><a href="https://unsplash.com/@v2osk">Featured Image by @V2osk</a></li>
<li><a href="https://www.networkfuntimes.com/new-series-a-guide-to-junos-for-ios-engineers/">Junos for IOS Engineers by Chris Parker</a></li>
<li><a href="https://www.pluralsight.com/authors/rich-bibby">Juniper Networks JNCIA Course by Rich Bibby on Pluralsight</a></li>
<li><a href="https://www.youtube.com/watch?v=xKe_KxT2doY">Scrapli CFG Video by IPvZero</a></li>
<li><a href="https://github.com/JulioPDX/junos-auto">GitHub Repository</a></li>
</ul>

      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://juliopdx.com/tags/junos/">Junos</a></span>
        <span class="tag"><a href="https://juliopdx.com/tags/network-automation/">Network Automation</a></span>
        <span class="tag"><a href="https://juliopdx.com/tags/python/">Python</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        2582 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2021-12-06 13:57
        

         
          
        
      </p>
    </div>

    
    <div class="pagination">
        
        <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
        </div>
        

        <div class="pagination__buttons">
            
            <span class="button previous">
                <a href="https://juliopdx.com/2021/12/10/my-journey-and-experience-with-containerlab/">
                    <span class="button__icon">←</span>
                    <span class="button__text">My Journey and Experience With Containerlab</span>
                </a>
            </span>
            

            
            <span class="button next">
                <a href="https://juliopdx.com/2021/11/22/my-journey-learning-about-the-palo-alto-networks-python-sdk/">
                    <span class="button__text">My Journey Learning About the Palo Alto Networks Python SDK</span>
                    <span class="button__icon">→</span>
                </a>
            </span>
            
        </div>
    </div>


    

    

  </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2022</span>
            <span><a href="https://juliopdx.com/"></a></span>
            
            <span><a href="https://juliopdx.com/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span><span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.45347cbb0cde6339c7e2884209e89aa98d055beefeef8208af7478ccbc2924f3f7db788a9419f3598da668e58e658febcd7d84f60c6108ccad165d369af8a363.js" integrity="sha512-RTR8uwzeYznH4ohCCeiaqY0FW&#43;7&#43;74IIr3R4zLwpJPP323iKlBnzWY2maOWOZY/rzX2E9gxhCMytFl02mvijYw=="></script>



    </body>
</html>
