<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author"
    content="">
<meta name="description"
    content="Intro I was recently working my way through Optimal Routing design by Cisco Press&amp;hellip; Can you tell that I get through books very slowly? I&amp;rsquo;ve probably used that sentence in my blog posts three or four times now! Either way, this chapter focused on scaling BGP and dealing with external connections. The section that really got me was external connections. The books goes over a lot, for example, handling inbound traffic, outbound traffic, full routes vs partial vs default." />
<meta name="keywords"
    content=", BGP, Docker, SR Linux, Arista" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://juliopdx.com/2022/02/25/exabgp-in-the-lab/" />


<title>
    
    ExaBGP in the Lab :: Welcome to the World of Tomorrow  — Welcome to my blog!
    
</title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.57323f540d7cbe7c215b2d5060bc45c58f58b905f86869d7183bb27c42937f00.css">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="ExaBGP in the Lab">
<meta itemprop="description" content="Intro I was recently working my way through Optimal Routing design by Cisco Press&hellip; Can you tell that I get through books very slowly? I&rsquo;ve probably used that sentence in my blog posts three or four times now! Either way, this chapter focused on scaling BGP and dealing with external connections. The section that really got me was external connections. The books goes over a lot, for example, handling inbound traffic, outbound traffic, full routes vs partial vs default."><meta itemprop="datePublished" content="2022-02-25T15:06:14-08:00" />
<meta itemprop="dateModified" content="2022-02-25T15:06:14-08:00" />
<meta itemprop="wordCount" content="3886"><meta itemprop="image" content="https://juliopdx.com/blog/images/greg-rakozy.jpg">
<meta itemprop="keywords" content="BGP,Docker,SR Linux,Arista," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://juliopdx.com/blog/images/greg-rakozy.jpg"/>

<meta name="twitter:title" content="ExaBGP in the Lab"/>
<meta name="twitter:description" content="Intro I was recently working my way through Optimal Routing design by Cisco Press&hellip; Can you tell that I get through books very slowly? I&rsquo;ve probably used that sentence in my blog posts three or four times now! Either way, this chapter focused on scaling BGP and dealing with external connections. The section that really got me was external connections. The books goes over a lot, for example, handling inbound traffic, outbound traffic, full routes vs partial vs default."/>




<meta property="og:title" content="ExaBGP in the Lab" />
<meta property="og:description" content="Intro I was recently working my way through Optimal Routing design by Cisco Press&hellip; Can you tell that I get through books very slowly? I&rsquo;ve probably used that sentence in my blog posts three or four times now! Either way, this chapter focused on scaling BGP and dealing with external connections. The section that really got me was external connections. The books goes over a lot, for example, handling inbound traffic, outbound traffic, full routes vs partial vs default." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://juliopdx.com/2022/02/25/exabgp-in-the-lab/" /><meta property="og:image" content="https://juliopdx.com/blog/images/greg-rakozy.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-25T15:06:14-08:00" />
<meta property="article:modified_time" content="2022-02-25T15:06:14-08:00" /><meta property="og:site_name" content="Welcome to the World of Tomorrow" />







<meta property="article:published_time" content="2022-02-25 15:06:14 -0800 PST" />












<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>mermaid.initialize({ startOnLoad: true, securityLevel: 'loose', theme: 'dark', align: 'center' });</script>

    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">#</span>
            <span class="logo__text">JulioPDX</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#41FF00;
                   animation-duration:2s;">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/posts">Blog</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        19 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://juliopdx.com/2022/02/25/exabgp-in-the-lab/">ExaBGP in the Lab</a>
      </h1>

      

      
        <hr />
        <aside id="toc">
          <div class="toc-title">Table of Contents</div>
          <nav id="TableOfContents">
  <ul>
    <li><a href="#intro">Intro</a></li>
    <li><a href="#the-topology">The Topology</a></li>
    <li><a href="#working-with-exabgp">Working with ExaBGP</a>
      <ul>
        <li><a href="#converting-manual-steps-to-dockerfile">Converting Manual Steps to Dockerfile</a></li>
        <li><a href="#migrating-docker-build-to-github-actions">Migrating Docker Build to GitHub Actions</a></li>
      </ul>
    </li>
    <li><a href="#incorporating-exabgp-in-the-lab">Incorporating ExaBGP in the Lab</a>
      <ul>
        <li><a href="#advertising-many-nlri">Advertising Many NLRI</a></li>
      </ul>
    </li>
    <li><a href="#use-cases">Use Cases</a>
      <ul>
        <li><a href="#reducing-excess-information-client-side">Reducing Excess Information Client Side</a></li>
        <li><a href="#reducing-excess-information-provider-side">Reducing Excess Information Provider Side</a></li>
        <li><a href="#outbound-traffic-steering">Outbound Traffic Steering</a></li>
      </ul>
    </li>
    <li><a href="#caveats">Caveats</a></li>
    <li><a href="#outro-and-links">Outro and Links</a></li>
  </ul>
</nav>
        </aside>
        <hr />

      

      <div class="post-content">
        <h2 id="intro">Intro</h2>
<p>I was recently working my way through Optimal Routing design by Cisco Press&hellip; Can you tell that I get through books very slowly? I&rsquo;ve probably used that sentence in my blog posts three or four times now! Either way, this chapter focused on scaling BGP and dealing with external connections. The section that really got me was external connections. The books goes over a lot, for example, handling inbound traffic, outbound traffic, full routes vs partial vs default. I wanted to see if there was a way to get a sample of the internet routing table in the lab. If you&rsquo;re reading this then the goal was accomplished or I failed miserably and I feel like venting to the world. Either way, if you skipped over this paragraph then you missed my bad humor. Shame on you!</p>
<h2 id="the-topology">The Topology</h2>
<div class="mermaid">
    
graph LR
  1((cmpa1))
  2((cmpa2))
  3((ispa))
  4((ispb))
  5((cloud))
  6((internet))
  1---3
  2---4
  3---5
  4---5
  6---5

</div>
<p>Company A(cmpa) has two connections to different ISPs. ISPA is in AS 65001 and ISPB is in AS 65002. Company A also has an iBGP peering between its edge nodes in cmpa1 and cmpa2. In this example I used Arista cEOS nodes as the company routers and Nokia SR Linux at the ISP side.</p>
<h2 id="working-with-exabgp">Working with ExaBGP</h2>
<p>When going down a particular route, I usually always check if something similar has been done before. I really don&rsquo;t like to reinvent the wheel and if someone has created it freely for the world, why not give it a shot! Thankfully I found two really great resources for ExaBGP. One from <a href="https://jasonmurray.org/posts/2020/exabgp-fulltable/">Jason Murray</a>, who made this happen before in GNS3 and a few great posts by <a href="https://thepacketgeek.com/exabgp/">Mat Wood</a>. These posts were incredibly insightful but the step to convert the BGP data from RIPE to an ExaBGP format was time consuming.</p>
<h3 id="converting-manual-steps-to-dockerfile">Converting Manual Steps to Dockerfile</h3>
<p>I eventually decided on wrapping these steps in a Dockerfile, which could then be used to build a container image. My eventual goal was to use this in a lab with something like Containerlab or Net-sim Tools.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> ubuntu:20.04</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Install dependencies</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> bgp.cfg .<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt update<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt install python3-pip net-tools wget mrtparse vim nano -y <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    rm -rf /var/lib/apt/lists/* <span style="color:#f92672">&amp;&amp;</span> apt clean<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> pip install exabgp<span style="color:#f92672">==</span>4.2.17<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Download latest table and remove when complete</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> wget https://data.ris.ripe.net/rrc16/latest-bview.gz<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> mrt2exabgp -G -P -4 172.16.2.1 latest-bview.gz &gt; fullbgptable.py<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> rm -rf latest-bview.gz<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>The default configuration file I created for ExaBGP supports two neighbors on AS 65001 and 65002 respectively. Vim and nano are included to allow users to modify this for their deployment. For example you could have ISP nodes on the same AS to simulate multiple external connections to the same ISP.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">process announce-routes {
    run python3 fullbgptable.py;
    encoder json;
}

template {
    neighbor AS_65000 {
        router-id 172.16.2.1;
        local-as 65000;
        local-address 172.16.2.1;
    }
}

neighbor 172.16.2.2 {
    inherit AS_65000;
    peer-as 65001;
}

neighbor 172.16.2.3 {
    inherit AS_65000;
    peer-as 65002;
}

</code></pre></div><p>This container is now on <a href="https://hub.docker.com/repository/docker/juliopdx/exabgp-irt">Docker Hub</a>, feel free to pull it down and check it out. After it was on Docker Hub, I had this random idea to automate the updates to the docker image. For example, the BGP view from RIPE is updated a decent amount throughout the day. I think it would be neat to grab the latest update at the end of the day and rebuild the docker image. This could then be tagged with <code>latest</code> and the <code>date</code> it was created.</p>
<h3 id="migrating-docker-build-to-github-actions">Migrating Docker Build to GitHub Actions</h3>
<p>GitHub Actions was fairly new to me, besides some hello world example. I found this neat example from <a href="https://medium.com/platformer-blog/lets-publish-a-docker-image-to-docker-hub-using-a-github-action-f0b17e5cceb3">Chamod Shehanka</a> that I used as a starting point. I still had to add scheduled updates and syncing the readme/description on Docker Hub with the repository on GitHub. The latter is only available for some pro version of Docker Hub automated builds but luckily there&rsquo;s a GitHub Action to get around this. Example starting workflow file below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Docker Image CI</span>

<span style="color:#f92672">on</span>:
  <span style="color:#f92672">push</span>:
    <span style="color:#f92672">branches</span>: [ <span style="color:#ae81ff">main ]</span>
  <span style="color:#f92672">pull_request</span>:
    <span style="color:#f92672">branches</span>: [ <span style="color:#ae81ff">main ]</span>

<span style="color:#f92672">jobs</span>:

  <span style="color:#f92672">build</span>:

    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>

    <span style="color:#f92672">steps</span>:
    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v2</span>
    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">docker login</span>
      <span style="color:#f92672">env</span>:
        <span style="color:#f92672">DOCKER_USER</span>: <span style="color:#ae81ff">${{secrets.DOCKER_USER }}</span>
        <span style="color:#f92672">DOCKER_PASSWORD</span>: <span style="color:#ae81ff">${{secrets.DOCKER_PASSWORD }}</span>
      <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">        </span>        <span style="color:#ae81ff">docker login -u $DOCKER_USER -p $DOCKER_PASSWORD</span>
    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Build the Docker image</span>
      <span style="color:#f92672">run</span>: <span style="color:#ae81ff">docker build . --file Dockerfile --tag juliopdx/exabgp-irt:$(date +%s)</span>

    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Docker Push</span>
      <span style="color:#f92672">run</span>: <span style="color:#ae81ff">docker push juliopdx/exabgp-irt</span>

</code></pre></div><h4 id="adding-github-actions">Adding GitHub Actions</h4>
<p>Shorty after I discovered two really slick GitHub Actions from some awesome folks to streamline the workflow and arguably make it look a bit cleaner. One being <a href="https://github.com/marketplace/actions/docker-build-push-action">Docker Build &amp; Push by Sean Smith</a> and the other <a href="https://github.com/marketplace/actions/docker-hub-readme-description-sync">sync-readme by Damian Mee</a>. Both offer a simplicity to the workflow file that I really enjoy. This led me to fairly finalizing this docker workflow.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Docker Image CI</span>

<span style="color:#f92672">on</span>:
  <span style="color:#f92672">push</span>:
    <span style="color:#f92672">branches</span>: [<span style="color:#ae81ff">main]</span>
  <span style="color:#f92672">pull_request</span>:
    <span style="color:#f92672">branches</span>: [<span style="color:#ae81ff">main]</span>
  <span style="color:#f92672">schedule</span>:
    - <span style="color:#f92672">cron</span>: <span style="color:#e6db74">&#34;0 0 * * *&#34;</span>

<span style="color:#f92672">jobs</span>:
  <span style="color:#f92672">build</span>:
    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>

    <span style="color:#f92672">steps</span>:
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">check out code</span>
        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v2</span>

      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">build and push docker image</span>
        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">mr-smithers-excellent/docker-build-push@v5</span>
        <span style="color:#f92672">with</span>:
          <span style="color:#f92672">image</span>: <span style="color:#ae81ff">juliopdx/exabgp-irt</span>
          <span style="color:#f92672">registry</span>: <span style="color:#ae81ff">docker.io</span>
          <span style="color:#f92672">username</span>: <span style="color:#ae81ff">${{ secrets.DOCKER_USER }}</span>
          <span style="color:#f92672">password</span>: <span style="color:#ae81ff">${{ secrets.DOCKER_PASSWORD }}</span>
          <span style="color:#f92672">tags</span>: <span style="color:#ae81ff">latest, $(date +%F)</span>

      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">sync desc and readme</span>
        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">meeDamian/sync-readme@v1.0.6</span>
        <span style="color:#f92672">with</span>:
          <span style="color:#f92672">user</span>: <span style="color:#ae81ff">${{secrets.DOCKER_USER }}</span>
          <span style="color:#f92672">pass</span>: <span style="color:#ae81ff">${{ secrets.DOCKER_PASSWORD }}</span>

</code></pre></div><h2 id="incorporating-exabgp-in-the-lab">Incorporating ExaBGP in the Lab</h2>
<p>Now that we have the docker image created, we can incorporate it in our lab. For this example I leveraged Containerlab.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">name</span>: <span style="color:#ae81ff">irt</span>
<span style="color:#f92672">prefix</span>: <span style="color:#e6db74">&#34;&#34;</span>

<span style="color:#f92672">topology</span>:

  <span style="color:#f92672">kinds</span>:
    <span style="color:#f92672">ceos</span>:
      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">ceos:4.27.2F</span>
    <span style="color:#f92672">srl</span>:
      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">ghcr.io/nokia/srlinux</span>

  <span style="color:#f92672">nodes</span>:
    <span style="color:#f92672">ispa</span>:
      <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">srl</span>
      <span style="color:#f92672">startup-config</span>: <span style="color:#ae81ff">conf/ispa.json</span>
      <span style="color:#f92672">mgmt_ipv4</span>: <span style="color:#ae81ff">172.20.20.11</span>
    <span style="color:#f92672">ispb</span>:
      <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">srl</span>
      <span style="color:#f92672">startup-config</span>: <span style="color:#ae81ff">conf/ispb.json</span>
      <span style="color:#f92672">mgmt_ipv4</span>: <span style="color:#ae81ff">172.20.20.12</span>
    <span style="color:#f92672">internet</span>: <span style="color:#75715e"># ifconfig eth1 172.16.2.1 netmask 255.255.255.0 up</span>
      <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">linux</span>
      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">juliopdx/exabgp-irt</span>
      <span style="color:#f92672">mgmt_ipv4</span>: <span style="color:#ae81ff">172.20.20.13</span>
    <span style="color:#f92672">cmpa1</span>:
      <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ceos</span>
      <span style="color:#f92672">startup-config</span>: <span style="color:#ae81ff">conf/cmpa1.conf</span>
      <span style="color:#f92672">mgmt_ipv4</span>: <span style="color:#ae81ff">172.20.20.14</span>
    <span style="color:#f92672">cmpa2</span>:
      <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ceos</span>
      <span style="color:#f92672">startup-config</span>: <span style="color:#ae81ff">conf/cmpa2.conf</span>
      <span style="color:#f92672">mgmt_ipv4</span>: <span style="color:#ae81ff">172.20.20.15</span>
    <span style="color:#f92672">cloud</span>:
      <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ceos</span>
      <span style="color:#f92672">mgmt_ipv4</span>: <span style="color:#ae81ff">172.20.20.16</span>

  <span style="color:#f92672">links</span>:
    - <span style="color:#f92672">endpoints</span>: [<span style="color:#e6db74">&#34;cloud:eth1&#34;</span>, <span style="color:#e6db74">&#34;internet:eth1&#34;</span>]
    - <span style="color:#f92672">endpoints</span>: [<span style="color:#e6db74">&#34;cloud:eth2&#34;</span>, <span style="color:#e6db74">&#34;ispa:e1-1&#34;</span>]
    - <span style="color:#f92672">endpoints</span>: [<span style="color:#e6db74">&#34;cloud:eth3&#34;</span>, <span style="color:#e6db74">&#34;ispb:e1-1&#34;</span>]
    - <span style="color:#f92672">endpoints</span>: [<span style="color:#e6db74">&#34;ispa:e1-2&#34;</span>, <span style="color:#e6db74">&#34;cmpa1:eth1&#34;</span>]
    - <span style="color:#f92672">endpoints</span>: [<span style="color:#e6db74">&#34;ispb:e1-2&#34;</span>, <span style="color:#e6db74">&#34;cmpa2:eth1&#34;</span>]
    - <span style="color:#f92672">endpoints</span>: [<span style="color:#e6db74">&#34;cmpa1:eth2&#34;</span>, <span style="color:#e6db74">&#34;cmpa2:eth2&#34;</span>]

</code></pre></div><p>For starters I&rsquo;ll configure the internet node(ExaBGP) with an IP address and activate ExaBGP. In this case not advertising routes, just validating peering.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">root@internet:/# cat bgp.cfg
#process announce-routes {
#    run python3 fullbgptable.py;
#    encoder json;
#}

template {
    neighbor AS_65000 {
        router-id 172.16.2.1;
        local-as 65000;
        local-address 172.16.2.1;
    }
}

neighbor 172.16.2.2 {
    inherit AS_65000;
    peer-as 65001;
}

neighbor 172.16.2.3 {
    inherit AS_65000;
    peer-as 65002;
}
root@internet:/#
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">juliopdx@containerlab:~$ docker exec -it internet bash
root@internet:/# ifconfig eth1 172.16.2.1 netmask 255.255.255.0 up
root@internet:/# exabgp bgp.cfg
04:47:01 | <span style="color:#ae81ff">22</span>     | welcome       | Thank you <span style="color:#66d9ef">for</span> using ExaBGP
04:47:01 | <span style="color:#ae81ff">22</span>     | version       | 4.2.17
04:47:01 | <span style="color:#ae81ff">22</span>     | interpreter   | 3.8.10 <span style="color:#f92672">(</span>default, Nov <span style="color:#ae81ff">26</span> 2021, 20:14:08<span style="color:#f92672">)</span>  <span style="color:#f92672">[</span>GCC 9.3.0<span style="color:#f92672">]</span>
04:47:01 | <span style="color:#ae81ff">22</span>     | os            | Linux internet 5.4.0-99-generic <span style="color:#75715e">#112-Ubuntu SMP Thu Feb 3 13:50:55 UTC 2022 x86_64</span>
04:47:01 | <span style="color:#ae81ff">22</span>     | installation  | /usr/local
04:47:01 | <span style="color:#ae81ff">22</span>     | advice        | environment file missing
04:47:01 | <span style="color:#ae81ff">22</span>     | advice        | generate it using <span style="color:#e6db74">&#34;exabgp --fi &gt; /usr/local/etc/exabgp/exabgp.env&#34;</span>
04:47:01 | <span style="color:#ae81ff">22</span>     | cli           | could not find the named pipes <span style="color:#f92672">(</span>exabgp.in and exabgp.out<span style="color:#f92672">)</span> required <span style="color:#66d9ef">for</span> the cli
04:47:01 | <span style="color:#ae81ff">22</span>     | cli           | we scanned the following folders <span style="color:#f92672">(</span>the number is your PID<span style="color:#f92672">)</span>:
04:47:01 | <span style="color:#ae81ff">22</span>     | cli control   |  - /run/exabgp/
04:47:01 | <span style="color:#ae81ff">22</span>     | cli control   |  - /run/0/
04:47:01 | <span style="color:#ae81ff">22</span>     | cli control   |  - /run/
04:47:01 | <span style="color:#ae81ff">22</span>     | cli control   |  - /var/run/exabgp/
04:47:01 | <span style="color:#ae81ff">22</span>     | cli control   |  - /var/run/0/
04:47:01 | <span style="color:#ae81ff">22</span>     | cli control   |  - /var/run/
04:47:01 | <span style="color:#ae81ff">22</span>     | cli control   |  - /usr/local/run/exabgp/
04:47:01 | <span style="color:#ae81ff">22</span>     | cli control   |  - /usr/local/run/0/
04:47:01 | <span style="color:#ae81ff">22</span>     | cli control   |  - /usr/local/run/
04:47:01 | <span style="color:#ae81ff">22</span>     | cli control   |  - /usr/local/var/run/exabgp/
04:47:01 | <span style="color:#ae81ff">22</span>     | cli control   |  - /usr/local/var/run/0/
04:47:01 | <span style="color:#ae81ff">22</span>     | cli control   |  - /usr/local/var/run/
04:47:01 | <span style="color:#ae81ff">22</span>     | cli control   | please make them in one of the folder with the following commands:
04:47:01 | <span style="color:#ae81ff">22</span>     | cli control   | &gt; mkfifo //run/exabgp.<span style="color:#f92672">{</span>in,out<span style="color:#f92672">}</span>
04:47:01 | <span style="color:#ae81ff">22</span>     | cli control   | &gt; chmod <span style="color:#ae81ff">600</span> //run/exabgp.<span style="color:#f92672">{</span>in,out<span style="color:#f92672">}</span>
04:47:01 | <span style="color:#ae81ff">22</span>     | configuration | performing reload of exabgp 4.2.17
04:47:01 | <span style="color:#ae81ff">22</span>     | reactor       | loaded new configuration successfully
04:47:01 | <span style="color:#ae81ff">22</span>     | reactor       | connected to peer-1 with outgoing-1 172.16.2.1-172.16.2.2
04:47:01 | <span style="color:#ae81ff">22</span>     | reactor       | connected to peer-2 with outgoing-1 172.16.2.1-172.16.2.3

</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">juliopdx@containerlab:~$ docker exec -it ispa sr_cli
Using configuration file(s): []
Welcome to the srlinux CLI.
Type &#39;help&#39; (and press &lt;ENTER&gt;) if you need any help using this.
--{ running }--[  ]--
A:ispa# show network-instance default protocols bgp neighbor
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
BGP neighbor summary for network-instance &#34;default&#34;
Flags: S static, D dynamic, L discovered by LLDP, B BFD enabled, - disabled, * slow
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
+-------------------+---------------------------+-------------------+-------+----------+---------------+---------------+--------------+---------------------------+
|     Net-Inst      |           Peer            |       Group       | Flags | Peer-AS  |     State     |    Uptime     |   AFI/SAFI   |      [Rx/Active/Tx]       |
+===================+===========================+===================+=======+==========+===============+===============+==============+===========================+
| default           | 10.0.0.1                  | cmpa              | S     | 65003    | established   | 0d:0h:4m:51s  | ipv4-unicast | [0/0/2]                   |
| default           | 172.16.2.1                | internet          | S     | 65000    | established   | 0d:0h:3m:21s  | ipv4-unicast | [0/0/2]                   |
+-------------------+---------------------------+-------------------+-------+----------+---------------+---------------+--------------+---------------------------+
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Summary:
2 configured neighbors, 2 configured sessions are established,0 disabled peers
0 dynamic peers
--{ running }--[  ]--
A:ispa#
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">juliopdx@containerlab:~$ docker exec -it ispb sr_cli
Using configuration file(s): []
Welcome to the srlinux CLI.
Type &#39;help&#39; (and press &lt;ENTER&gt;) if you need any help using this.
--{ running }--[  ]--
A:ispb# show network-instance default protocols bgp neighbor
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
BGP neighbor summary for network-instance &#34;default&#34;
Flags: S static, D dynamic, L discovered by LLDP, B BFD enabled, - disabled, * slow
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
+-------------------+---------------------------+-------------------+-------+----------+---------------+---------------+--------------+---------------------------+
|     Net-Inst      |           Peer            |       Group       | Flags | Peer-AS  |     State     |    Uptime     |   AFI/SAFI   |      [Rx/Active/Tx]       |
+===================+===========================+===================+=======+==========+===============+===============+==============+===========================+
| default           | 10.0.0.2                  | cmpa              | S     | 65003    | established   | 0d:0h:6m:18s  | ipv4-unicast | [0/0/2]                   |
| default           | 172.16.2.1                | internet          | S     | 65000    | established   | 0d:0h:4m:49s  | ipv4-unicast | [0/0/2]                   |
+-------------------+---------------------------+-------------------+-------+----------+---------------+---------------+--------------+---------------------------+
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Summary:
2 configured neighbors, 2 configured sessions are established,0 disabled peers
0 dynamic peers
--{ running }--[  ]--
A:ispb#
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">juliopdx@containerlab:~$ docker exec -it cmpa1 Cli
cmpa1&gt;en
cmpa1#show ip bgp summary
BGP summary information for VRF default
Router identifier 10.0.0.1, local AS number 65003
Neighbor Status Codes: m - Under maintenance
  Neighbor V AS           MsgRcvd   MsgSent  InQ OutQ  Up/Down State   PfxRcd PfxAcc
  10.0.0.0 4 65001             24        29    0    0 00:10:22 Estab   2      2
  10.0.0.7 4 65003             17        16    0    0 00:10:22 Estab   2      2
cmpa1#
</code></pre></div><h3 id="advertising-many-nlri">Advertising Many NLRI</h3>
<p>At this point all peering has been verified. I will reenable ExaBGP but advertise all the routes this time. This process does take some time to complete and I will explain a few caveats at the end of this post.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">root@internet:/# cat bgp.cfg
process announce-routes {
    run python3 fullbgptable.py;
    encoder json;
}

template {
    neighbor AS_65000 {
        router-id 172.16.2.1;
        local-as 65000;
        local-address 172.16.2.1;
    }
}

neighbor 172.16.2.2 {
    inherit AS_65000;
    peer-as 65001;
}

neighbor 172.16.2.3 {
    inherit AS_65000;
    peer-as 65002;
}
root@internet:/# exabgp bgp.cfg
</code></pre></div><p>I&rsquo;ll save your eyes, the output is a lot! For fun, lets check out some crazy prefix numbers on one ISP node and one Company A node.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">A:ispa# show network-instance default protocols bgp summary
------------------------------------------------------------------------------------------------------------------------------------------------
BGP is enabled and up in network-instance &#34;default&#34;
Global AS number  : 65001
BGP identifier    : 172.16.2.2
------------------------------------------------------------------------------------------------------------------------------------------------
  Total paths               : 990
  Received routes           : 74867
  Received and active routes: 74467
  Total UP peers            : 2
  Configured peers          : 2, 0 are disabled
  Dynamic peers             : None
------------------------------------------------------------------------------------------------------------------------------------------------
--{ running }--[  ]--
A:ispa#
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">cmpa1#show ip bgp summary
BGP summary information for VRF default
Router identifier 10.0.0.1, local AS number 65003
Neighbor Status Codes: m - Under maintenance
  Neighbor V AS           MsgRcvd   MsgSent  InQ OutQ  Up/Down State   PfxRcd PfxAcc
  10.0.0.0 4 65001           1672       721    0    0 00:21:26 Estab   87670  87670
  10.0.0.7 4 65003           1684      1668    0    0 00:21:26 Estab   86701  86701
cmpa1#
</code></pre></div><p>That is beautiful, 74K routes on ISPA and 87K routes on Company A node.</p>
<h2 id="use-cases">Use Cases</h2>
<h3 id="reducing-excess-information-client-side">Reducing Excess Information Client Side</h3>
<p>Let me walk through a few examples on how this could be useful in a lab scenario or for general learning. You may have noticed that the Company A node is receiving routes from both ISPA and the iBGP neighbor. Seems like a bit of a waste in resources and memory. We can configure the iBGP neighbors to only send the default route from the ISP. The below configuration is done on both node 1 and 2 of Company A.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">ip prefix-list default seq 10 permit 0.0.0.0/0
!
route-map default permit 10
   match ip address prefix-list default
router bgp 65003
   neighbor 10.0.0.7 route-map default out
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">cmpa1#show ip bgp summary
BGP summary information for VRF default
Router identifier 10.0.0.1, local AS number 65003
Neighbor Status Codes: m - Under maintenance
  Neighbor V AS           MsgRcvd   MsgSent  InQ OutQ  Up/Down State   PfxRcd PfxAcc
  10.0.0.0 4 65001           8341      7566    0    0 00:31:11 Estab   18898  18898
  10.0.0.7 4 65003           8540      8454    0    0 00:31:11 Estab   1      1
cmpa1#
</code></pre></div><p>Now we are only receiving the default route from our iBGP neighbor! This iBGP route map also has the benefit of preventing our AS from being a transit AS. Routes learned from one node will not be advertised to the other ISP and possibly severely hindering our edge devices. Maybe we want to filter the routes inbound from the ISPs.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">router bgp 65003
   neighbor 10.0.0.0 route-map default in
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">cmpa1#show ip bgp sum
BGP summary information for VRF default
Router identifier 10.0.0.1, local AS number 65003
Neighbor Status Codes: m - Under maintenance
  Neighbor V AS           MsgRcvd   MsgSent  InQ OutQ  Up/Down State   PfxRcd PfxAcc
  10.0.0.0 4 65001          30589      7657    0    0 01:09:18 Estab   257372 1
  10.0.0.7 4 65003           8585      8499    0    0 01:09:17 Estab   1      1
cmpa1#show ip bgp | b Network
          Network                Next Hop              Metric  AIGP       LocPref Weight  Path
 * &gt;      0.0.0.0/0              10.0.0.0              0       -          100     0       65001 199524 3257 i
 *        0.0.0.0/0              10.0.0.7              0       -          100     0       65002 199524 3257 i
cmpa1#
</code></pre></div><h3 id="reducing-excess-information-provider-side">Reducing Excess Information Provider Side</h3>
<p>Maybe we have a really simple site and we no longer need full tables. Our days of being fancy are over. I&rsquo;ll remove the previous configuration besides the iBGP route-map. Then we will update the ISP to only send the default.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">juliopdx@containerlab:~$ docker exec -it ispa sr_cli
Using configuration file(s): []
Welcome to the srlinux CLI.
Type &#39;help&#39; (and press &lt;ENTER&gt;) if you need any help using this.
--{ running }--[  ]--
A:ispa# enter candidate
--{ candidate shared default }--[  ]--
A:ispa# routing-policy
--{ candidate shared default }--[ routing-policy ]--
A:ispa# set policy default-route default-action reject
A:ispa# set policy default-route statement 10 match prefix-set default
A:ispa# set policy default-route statement 10 action accept
A:ispa# set prefix-set default prefix 0.0.0.0/0 mask-length-range exact
A:ispa# /network-instance default protocols bgp
--{ * candidate shared default }--[ network-instance default protocols bgp ]--
A:ispa# set group cmpa export-policy default-route
A:ispa# commit save
/system:
    Saved current running configuration as initial (startup) configuration &#39;/etc/opt/srlinux/config.json&#39;

All changes have been committed. Leaving candidate mode.
--{ running }--[ network-instance default protocols bgp ]--
A:ispa# show neighbor 10.0.0.1 advertised-routes ipv4
------------------------------------------------------------------------------------------------------------------------------------------------
Peer        : 10.0.0.1, remote AS: 65003, local AS: 65001
Type        : static
Description : None
Group       : cmpa
------------------------------------------------------------------------------------------------------------------------------------------------
Origin codes: i=IGP, e=EGP, ?=incomplete
+---------------------------------------------------------------------------------------------------------------------------------------------+
|          Network                  Next Hop              MED           LocPref                       AsPath                       Origin     |
+=============================================================================================================================================+
| 0.0.0.0/0                    10.0.0.0                    -              100        [65001, 199524, 3257]                            i       |
+---------------------------------------------------------------------------------------------------------------------------------------------+
------------------------------------------------------------------------------------------------------------------------------------------------
1 advertised BGP routes
------------------------------------------------------------------------------------------------------------------------------------------------
--{ running }--[ network-instance default protocols bgp ]--
A:ispa#
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">cmpa1#  show ip bgp sum
BGP summary information for VRF default
Router identifier 10.0.0.1, local AS number 65003
Neighbor Status Codes: m - Under maintenance
  Neighbor V AS           MsgRcvd   MsgSent  InQ OutQ  Up/Down State   PfxRcd PfxAcc
  10.0.0.0 4 65001          35789      7711    0    0 01:30:56 Estab   1      1
  10.0.0.7 4 65003           8615      8526    0    0 01:30:56 Estab   1      1
cmpa1#
</code></pre></div><h3 id="outbound-traffic-steering">Outbound Traffic Steering</h3>
<h4 id="partial-routes-on-each-node-by-as-path-length">Partial Routes on Each Node by AS Path Length</h4>
<p>Maybe we want to control outbound paths on each Company A node. One node gets routes with AS path length of three or less with a default route. The other will get routes with an AS length of four or more and a default. The iBGP route map will be removed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text"># cmpa1
ip prefix-list default seq 10 permit 0.0.0.0/0
!
route-map default permit 5
   match as-path length &lt;= 3
!
route-map default permit 10
   match ip address prefix-list default
!
router bgp 65003
   neighbor 10.0.0.0 route-map default in

# cmpa2
ip prefix-list default seq 10 permit 0.0.0.0/0
!
route-map default permit 5
   match as-path length &gt;= 4 and &lt;= 4000
!
route-map default permit 10
   match ip address prefix-list default
!
router bgp 65003
   neighbor 10.0.0.3 route-map default in
</code></pre></div><p>I&rsquo;ll share a small sample from active BGP NLRI on each node. Note the AS path lengh on that information.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">cmpa1#show ip bgp neighbors 10.0.0.0 routes | b AS Path
AS Path Attributes: Or-ID - Originator ID, C-LST - Cluster List, LL Nexthop - Link Local Nexthop

          Network                Next Hop              Metric  AIGP       LocPref Weight  Path
 * &gt;      0.0.0.0/0              10.0.0.0              0       -          100     0       65001 199524 3257 i
 * &gt;      1.0.0.0/24             10.0.0.0              0       -          100     0       65001 52320 13335 i
 * &gt;      1.1.1.0/24             10.0.0.0              0       -          100     0       65001 52320 13335 i
 * &gt;      1.9.0.0/16             10.0.0.0              0       -          100     0       65001 6939 4788 i
 * &gt;      1.12.0.0/20            10.0.0.0              0       -          100     0       65001 52320 132203 i
 * &gt;      1.12.34.0/23           10.0.0.0              0       -          100     0       65001 52320 132203 i
 * &gt;      1.37.0.0/16            10.0.0.0              0       -          100     0       65001 6939 4775 i
 * &gt;      1.37.0.0/17            10.0.0.0              0       -          100     0       65001 6939 4775 i
 * &gt;      1.37.27.0/24           10.0.0.0              0       -          100     0       65001 6939 4775 i
 * &gt;      1.37.32.0/24           10.0.0.0              0       -          100     0       65001 6939 4775 i
 * &gt;      1.37.35.0/24           10.0.0.0              0       -          100     0       65001 6939 4775 i
 * &gt;      1.37.36.0/22           10.0.0.0              0       -          100     0       65001 6939 4775 i
 * &gt;      1.37.47.0/24           10.0.0.0              0       -          100     0       65001 6939 4775 i
 * &gt;      1.37.86.0/24           10.0.0.0              0       -          100     0       65001 6939 4775 i
 * &gt;      1.37.128.0/17          10.0.0.0              0       -          100     0       65001 6939 4775 i
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">cmpa2#show ip bgp neighbors 10.0.0.3 routes | b AS Path
AS Path Attributes: Or-ID - Originator ID, C-LST - Cluster List, LL Nexthop - Link Local Nexthop

          Network                Next Hop              Metric  AIGP       LocPref Weight  Path
 * &gt;      0.0.0.0/0              10.0.0.3              0       -          100     0       65002 199524 3257 i
 * &gt;      1.0.4.0/22             10.0.0.3              0       -          100     0       65002 6939 4826 38803 i
 * &gt;      1.0.4.0/24             10.0.0.3              0       -          100     0       65002 6939 4826 38803 i
 * &gt;      1.0.5.0/24             10.0.0.3              0       -          100     0       65002 6939 4826 38803 i
 * &gt;      1.0.6.0/24             10.0.0.3              0       -          100     0       65002 6939 4826 38803 i
 * &gt;      1.0.7.0/24             10.0.0.3              0       -          100     0       65002 6939 4826 38803 i
 * &gt;      1.0.64.0/18            10.0.0.3              0       -          100     0       65002 52320 1299 2497 7670 18144 i
 * &gt;      1.0.128.0/17           10.0.0.3              0       -          100     0       65002 6939 38040 23969 i
 * &gt;      1.0.128.0/18           10.0.0.3              0       -          100     0       65002 6939 38040 23969 i
 * &gt;      1.0.128.0/19           10.0.0.3              0       -          100     0       65002 6939 38040 23969 i
 * &gt;      1.0.128.0/24           10.0.0.3              0       -          100     0       65002 6939 4651 23969 i
 * &gt;      1.0.129.0/24           10.0.0.3              0       -          100     0       65002 6939 4651 23969 i
 * &gt;      1.0.130.0/23           10.0.0.3              0       -          100     0       65002 6939 38040 23969 i
 * &gt;      1.0.132.0/24           10.0.0.3              0       -          100     0       65002 6939 38040 23969 i
 * &gt;      1.0.133.0/24           10.0.0.3              0       -          100     0       65002 6939 38040 23969 i
</code></pre></div><h4 id="partial-routes-on-each-node-by-prefix">Partial Routes on Each Node by Prefix</h4>
<p>Please see the updated configuration on each node and their respective NLRI.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text"># cmpa1
ip prefix-list default seq 10 permit 0.0.0.0/0
ip prefix-list half seq 10 permit 0.0.0.0/1 le 32
!
route-map default permit 5
   match ip address prefix-list half
!
route-map default permit 10
   match ip address prefix-list default
!
router bgp 65003
   neighbor 10.0.0.0 route-map default in

# cmpa2
ip prefix-list default seq 10 permit 0.0.0.0/0
ip prefix-list half seq 10 permit 128.0.0.0/2 le 32
!
route-map default permit 5
   match ip address prefix-list half
!
route-map default permit 10
   match ip address prefix-list default
!
router bgp 65003
   neighbor 10.0.0.3 route-map default in
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">cmpa1# show ip bgp neighbors 10.0.0.0 routes | b AS Path
AS Path Attributes: Or-ID - Originator ID, C-LST - Cluster List, LL Nexthop - Link Local Nexthop

          Network                Next Hop              Metric  AIGP       LocPref Weight  Path
 * &gt;      0.0.0.0/0              10.0.0.0              0       -          100     0       65001 199524 3257 i
 * &gt;      1.0.0.0/24             10.0.0.0              0       -          100     0       65001 52320 13335 i
 * &gt;      1.0.4.0/22             10.0.0.0              0       -          100     0       65001 6939 4826 38803 i
 * &gt;      1.0.4.0/24             10.0.0.0              0       -          100     0       65001 6939 4826 38803 i
 * &gt;      1.0.5.0/24             10.0.0.0              0       -          100     0       65001 6939 4826 38803 i
 * &gt;      1.0.6.0/24             10.0.0.0              0       -          100     0       65001 6939 4826 38803 i
 * &gt;      1.0.7.0/24             10.0.0.0              0       -          100     0       65001 6939 4826 38803 i
 * &gt;      1.0.64.0/18            10.0.0.0              0       -          100     0       65001 52320 1299 2497 7670 18144 i
 * &gt;      1.0.128.0/17           10.0.0.0              0       -          100     0       65001 6939 38040 23969 i
 * &gt;      1.0.128.0/18           10.0.0.0              0       -          100     0       65001 6939 38040 23969 i
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">cmpa2#show ip bgp neighbors 10.0.0.3 routes | b AS Path
AS Path Attributes: Or-ID - Originator ID, C-LST - Cluster List, LL Nexthop - Link Local Nexthop

          Network                Next Hop              Metric  AIGP       LocPref Weight  Path
 * &gt;      0.0.0.0/0              10.0.0.3              0       -          100     0       65002 199524 3257 i
 * &gt;      128.0.1.0/24           10.0.0.3              0       -          100     0       65002 52320 9009 i
 * &gt;      128.0.116.0/24         10.0.0.3              0       -          100     0       65002 52320 1299 57878 i
 * &gt;      128.0.118.0/24         10.0.0.3              0       -          100     0       65002 52320 1299 57878 i
 * &gt;      128.1.36.0/24          10.0.0.3              0       -          100     0       65002 6939 4766 i
 * &gt;      128.1.76.0/24          10.0.0.3              0       -          100     0       65002 6939 4766 i
 * &gt;      128.28.0.0/16          10.0.0.3              0       -          100     0       65002 52320 2914 2514 2514 i
 * &gt;      128.45.0.0/16          10.0.0.3              0       -          100     0       65002 52320 1267 24608 i
 * &gt;      128.53.0.0/16          10.0.0.3              0       -          100     0       65002 52320 2914 2514 2514 i
 * &gt;      128.65.96.0/21         10.0.0.3              0       -          100     0       65002 6939 42010 i
</code></pre></div><h2 id="caveats">Caveats</h2>
<p>Now for the issues I had with ExaBGP. I really shouldn&rsquo;t say issues, the things I ran into were mostly user error. I&rsquo;ve spent about two days with it and I really like it so far. Like anything I write, this was just a tiny fraction of what ExaBGP can do. If you see some error in the Dockerfile or process in general, please reach out to me. I&rsquo;d love to update this and get it nicely packaged into something useful. One error I ran into, at some point in the NLRI announcements, ExaBGP will just stop sending or keep a peer session established. It&rsquo;s something I haven&rsquo;t figured out and if someone more familiar with the tool can give me some insight, I&rsquo;m all ears!</p>
<h2 id="outro-and-links">Outro and Links</h2>
<p>Thank you all for reading this far. Really means the world to me and writing this one was a joy. Anytime I get to play with BGP in the lab is a good time. So much to learn with BGP&hellip; I tried to include links of posts or documents that helped me throughout this small journey. Please check them out if you have time. Below are some additional links that helped me out a lot!</p>
<ul>
<li><a href="https://github.com/Exa-Networks/exabgp">ExaBGP GitHub</a></li>
<li><a href="https://thepacketgeek.com/exabgp/">ExaBGP Posts by Mat Wood</a></li>
<li><a href="https://jasonmurray.org/posts/2020/exabgp-fulltable/">ExaBGP fulltable by Jaon Murray</a></li>
<li><a href="https://data.ris.ripe.net/rrc16/">RRC16 BGP Information</a></li>
<li><a href="https://github.com/t2mune/mrtparse/tree/master/examples">mrtparse, Convert BGP Information to ExaBGP Format</a></li>
<li><a href="https://jasonet.co/posts/scheduled-actions/">Run Actions on a Shedule by Jason Etcovitch</a></li>
<li><a href="https://netcraftsmen.com/internet-edge-traffic-steering-part-1/">Internet Edge: Traffic Steering Part 1-3 by Peter Welcher</a></li>
<li><a href="https://hub.docker.com/repository/docker/juliopdx/exabgp-irt">ExaBGP-IRT Docker Hub</a></li>
<li><a href="https://github.com/JulioPDX/learning_labs/tree/main/labs/bgp/exabgp">Containerlab Clab File Used in Blog</a></li>
</ul>

      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://juliopdx.com/tags/bgp/">BGP</a></span>
        <span class="tag"><a href="https://juliopdx.com/tags/docker/">Docker</a></span>
        <span class="tag"><a href="https://juliopdx.com/tags/sr-linux/">SR Linux</a></span>
        <span class="tag"><a href="https://juliopdx.com/tags/arista/">Arista</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        3886 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2022-02-25 15:06
        

         
          
        
      </p>
    </div>

    
    <div class="pagination">
        
        <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
        </div>
        

        <div class="pagination__buttons">
            
            <span class="button previous">
                <a href="https://juliopdx.com/2022/03/28/node-connections-with-netreplica-and-containerlab/">
                    <span class="button__icon">←</span>
                    <span class="button__text">Node Connections With Netreplica and Containerlab</span>
                </a>
            </span>
            

            
            <span class="button next">
                <a href="https://juliopdx.com/2022/02/17/test/">
                    <span class="button__text">Test</span>
                    <span class="button__icon">→</span>
                </a>
            </span>
            
        </div>
    </div>


    

    

  </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2022</span>
            <span><a href="https://juliopdx.com/"></a></span>
            
            <span><a href="https://juliopdx.com/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span><span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
    
    <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="juliopdx" data-description="Support me on Buy me a coffee!" data-message="Thank you for all the support. Caffeine helps keep the blogs coming!" data-color="#40DCA5" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.45347cbb0cde6339c7e2884209e89aa98d055beefeef8208af7478ccbc2924f3f7db788a9419f3598da668e58e658febcd7d84f60c6108ccad165d369af8a363.js" integrity="sha512-RTR8uwzeYznH4ohCCeiaqY0FW&#43;7&#43;74IIr3R4zLwpJPP323iKlBnzWY2maOWOZY/rzX2E9gxhCMytFl02mvijYw=="></script>



    </body>
</html>
